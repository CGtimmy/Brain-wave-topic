filename = '/Users/hoyi/Downloads/0708何翊/20240708162218_test_bleEXGdata.mat';
data_struct = load(filename);

data = data_struct.data;

% 確保數據是數組
data = double(data);
fs = 250;

disp("數據形狀:");
disp(size(data));
data = data';
% 提取和處理通道數據
CH1 = data(:, 1);
CH2 = data(:, 2);

disp("CH1 長度:");
disp(length(CH1));
disp("CH2 長度:");
disp(length(CH2));

% 計算CH3
CH3 = CH1 - CH2;

total_time = length(CH3) / fs;
fprintf('整段時間: %.2f 秒\n', total_time);

% 生成時間向量
t = (0:length(CH3)-1) / fs;

% 繪製波形
figure;
plot(t, CH3);
ylim([-60 60]);
title('CH3 波形');
xlabel('時間 (秒)');
ylabel('振幅');
grid on;

% 計算並繪製 STFT
win = hamming(256);     % 使用 Hamming 窗口
noverlap = 128;         % 重疊部分
nfft = 512;             % FFT 點數

[~, f, t_stft, ps] = spectrogram(CH3, win, noverlap, nfft, fs);

% 繪製 STFT 圖，不使用 dB
figure;
surf(t_stft / 60, f, abs(ps), 'EdgeColor', 'none'); % 將時間軸轉換為分鐘
axis xy; axis tight; view(0, 90);
ylim([0 40]);
caxis([-10 20]);
title('短時傅里葉變換 (STFT)');
xlabel('時間 (秒)');
ylabel('頻率 (Hz)');
colorbar;
ylabel(colorbar, '振幅');
